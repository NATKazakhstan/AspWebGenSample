/*
 * Generated by: Sergey.Shpakovskiy
 * Generated at: 1.0.0.3
 * Copyright © JSC NAT Kazakhstan 2011
 */
#pragma warning disable
using System;
using System.Collections;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data.Linq;
using System.Diagnostics;
using System.Diagnostics.CodeAnalysis;
using System.Globalization;
using System.Linq;
using System.Linq.Expressions;
using System.Reflection;
using System.Security.Principal;
using System.Text;
using System.Web;
using System.Web.Caching;
using System.Web.Compilation;
using System.Web.Script.Serialization;
using System.Web.UI;
using System.Web.UI.WebControls;
using JS.LinqToJavaScript;

using Nat.Tools.Specific;
using Nat.Web.Controls;
using Nat.Web.Controls.GenerationClasses;
using Nat.Web.Controls.GenerationClasses.Data;
using Nat.Web.Controls.GenerationClasses.Filter;
using Nat.Web.Controls.GenerationClasses.Navigator;
using Nat.Web.Controls.HistoryFilters;
using Nat.Web.Controls.Preview;
using Nat.Web.Tools;
using Nat.Web.Tools.Security;
using Nat.Web.Tools.WorkFlow;
using SampleDictionaries.UserControls;
using SampleDictionaries.Properties;
using SampleDictionaries.Security;
using AccessOptions = SampleDictionaries.MyProductActionsAccessOptions;
using SampleDictionaries;
using SampleDictionaries.UserControls;
using SampleDictionaries.Properties;

using Nat.Web.Tools.ExtNet.Data;
using Nat.Web.Tools.ExtNet.Extenders;
using Nat.Web.Tools.ExtNet.ExtNetConfig;

namespace SampleDictionaries
{
    #region MyProductActionsJournalDataSourceView

    public partial class MyProductActionsJournalDataSourceView : BaseDataSourceView<long, MyProductAction, DBDataContext, MyProductActionsJournalDataSourceView.Row>, IDataSourceView2, IDataSourceView3, IHeaderControl, IDataSourceViewExtNet
    {
        private readonly BaseDataSource<long> owner;
        private SelectModeMyProductActions? _select;
        private MyProductActionsFilter _filterSelect;
        private bool? _showHistory;
        private IEnumerable<Row> _cache;
        private MainPageUrlBuilder _url;

        public MyProductActionsJournalDataSourceView(BaseDataSource<long> owner, string viewName)
            : base(owner, viewName)
        {
            this.owner = owner;
            this.Lookup = new LookupExpressions { GetUrl = () => _url };
        }

        public MyProductActionsJournalDataSourceView()
            : base(new MyProductActionsJournalDataSource(), string.Empty)
        {
            this.Lookup = new LookupExpressions { GetUrl = () => _url };
        }
                
        public override bool LookupValuesHidden
        {
            set 
            {
                base.LookupValuesHidden = value;
                Lookup.DefaultHidden = value;
            }
        }
        
        public LookupExpressions Lookup { get; private set; }

        public SelectModeMyProductActions SelectMode
        {
            get 
            {
                try
                {
                    if (_url != null)
                        _select = (SelectModeMyProductActions?)Enum.Parse(typeof(SelectModeMyProductActions), _url.SelectMode, true);
                    if (owner == null && _select == null) _select = SelectModeMyProductActions.none;
                    if (_select == null) _select = (SelectModeMyProductActions?)Enum.Parse(typeof(SelectModeMyProductActions), MainPageUrlBuilder.GetSelectMode(owner.Page), true);
                }
                catch
                {
                    _select = SelectModeMyProductActions.none;
                }
                
                return _select.Value;
            }
            
            set
            {
                _select = value;
            }
        }

        public override string TableName
        {
            get { return "MyProductActions"; }
        }

        public override bool CanSort
        {
            get { return true; }
        }

        public override bool CanPage
        {
            get { return true; }
        }

        public override bool CanRetrieveTotalRowCount
        {
            get { return true; }
        }

        public string Header
        {
            get { return MyProductActionsResources.Header; }
        }

        public string HeaderRu
        {
            get { return MyProductActionsResources.ResourceManager.GetString("Header", new CultureInfo("ru-ru")); }
        }

        public string HeaderKz
        {
            get { return MyProductActionsResources.ResourceManager.GetString("Header", new CultureInfo("kk-kz")); }
        }

        partial void InitDefaultSort(ref string sortValue);
        
        protected override string DefaultSort
        {
            get
            {
                var sortValue = "MyProduct_refProduct.Name,id";
                InitDefaultSort(ref sortValue);
                return sortValue;
            }
        }

        protected override string RequiredSort
        {
            get { return "id"; }
        }
        
        public override bool SupportGlobalCache { get { return false; } }

        public override bool SupportSelectICodeRow
        {
            get { return false; }
        }

        [Conditional("DEBUG")]
        private void WriteTrace(string value)
        {
            if (owner != null && owner.Page != null)
                owner.Page.Trace.Write(value);
        }

        protected override DBDataContext CreateDataContext()
        {
            var db = InitConnection == null ? new DBDataContext(SpecificInstances.DbFactory.CreateConnection()) : new DBDataContext(InitConnection);
            return db;
        }

        protected override IWorkFlow[] CreateWorkFlows()
        {
            return new IWorkFlow[] {};
        }

        private IEnumerable<Row> EnsureExistRow(IQueryable<Row> rows)
        {
            if (!AllowCreateSelectedRow || _selectedID == null) return rows;
            var list = rows.ToList();
            foreach (var item in list)
                if (item.id == _selectedID.Value)
                    return list;
            list.Add(new Row
            {
                id = _selectedID.Value,
                Value = _selectedID.Value.ToString(),
                nameRu = Nat.Web.Controls.Properties.Resources.SNotExistRow,
                nameKz = Nat.Web.Controls.Properties.Resources.SNotExistRow,
            });
            return list;
        }

        public override string GetStringID(MyProductAction row)
        {
            return GetID(row).ToString();
        }

        public override long? GetID(MyProductAction row)
        {
            return row.id;
        }

        public override long? GetIDByRefParent(MyProductAction row)
        {
            return null;
        }

        protected override bool UseTreeFilter { get { return false; } }

        public IQueryable<Row> GetSelect(long id)
        {
            return GetSelect(id, string.Empty);
        }

        public IQueryable<Row> GetSelect(long id, bool isKz)
        {
            return GetSelect(id, string.Empty, isKz);
        }

        public IQueryable<Row> GetSelect(long id, string selectColumnName)
        {
            return GetSelect(selectColumnName).Where(p => p.Item.id == id);
        }

        public IQueryable<Row> GetSelect(long id, string selectColumnName, bool isKz)
        {
            return GetSelect(selectColumnName, isKz).Where(p => p.Item.id == id);
        }

        public IQueryable<Row> GetSelect(long id, string selectColumnName, bool isKz, bool isTreeFilter)
        {
            return GetSelect(null, selectColumnName, isKz, isTreeFilter).Where(p => p.Item.id == id);
        }

        public override IQueryable<IRow> GetSelectIRow(long id)
        {
            return GetSelect(id).Cast<IRow>();
        }

        public override IQueryable<ICodeRow> GetSelectICodeRow(long id)
        {
            throw new NotImplementedException();
        }

        public override IQueryable<IRow> GetSelectIRow()
        {
            return GetSelect().Cast<IRow>();
        }

        public override IQueryable<ICodeRow> GetSelectICodeRow()
        {
            throw new NotImplementedException();
        }

        public IQueryable<Row> GetSelectWithoutFilters(long id)
        {
            return GetSelectWithoutFilters(id, string.Empty);
        }

        public IQueryable<Row> GetSelectWithoutFilters(long id, string selectColumnName)
        {
            return GetSelectWithoutFilters(selectColumnName).Where(p => p.Item.id == id);
        }

        public override Expression<Func<MyProductAction, long, bool>> GetWhereByKey()
        {
            return (p, id) => p.id == id;
        }

        public override object GetKey(string key)
        {
            return Convert.ToInt64(key);
        }

        public override string GetName(long id, string selectColumnName, bool isKz)
        {
            if (isKz)
                return GetSelectWithoutFilters(id, selectColumnName).Select(p => p.nameKz).FirstOrDefault();
            return GetSelectWithoutFilters(id, selectColumnName).Select(p => p.nameRu).FirstOrDefault();
        }

        public override IQueryable<BaseRow> GetSelectRow(long value, string selectColumnName)
        {
            return GetSelect(value, selectColumnName).Cast<BaseRow>();
        }

        public override IQueryable<IRow> GetSelectIRow(string queryParameters)
        {
            DB.ObjectTrackingEnabled = false;
            DB.DeferredLoadingEnabled = false;
            _filterSelect = new MyProductActionsFilter();
            var urlBuilder = new MainPageUrlBuilder("/MainPage.aspx/data/MyProductActionsJournal/Select?" + queryParameters);
            _filterSelect.SetUrl(urlBuilder);
            _filterSelect.SetDB(DB);
            _url = urlBuilder;
            SelectForAddType = urlBuilder.SelectForAddType;
            SelectParameters = urlBuilder.SelectParameters;
            AddSearchInFilter(urlBuilder, _filterSelect);
            if (!string.IsNullOrEmpty(urlBuilder.SelectNameColumn))
                return GetSelect(urlBuilder.SelectNameColumn).Cast<IRow>().Select(r => r);
            return GetSelect().Cast<IRow>().Select(r => r);
        }

        IQueryable<IDataRow> IDataSourceView2.GetSelectIRow(string queryParameters)
        {
            DB.ObjectTrackingEnabled = false;
            DB.DeferredLoadingEnabled = false;
            _filterSelect = new MyProductActionsFilter();
            var urlBuilder = new MainPageUrlBuilder("/MainPage.aspx/data/MyProductActionsJournal/Select?" + queryParameters);
            _filterSelect.SetUrl(urlBuilder);
            _filterSelect.SetDB(DB);
            _url = urlBuilder;
            SelectForAddType = urlBuilder.SelectForAddType;
            SelectParameters = urlBuilder.SelectParameters;
            AddSearchInFilter(urlBuilder, _filterSelect);
            if (!string.IsNullOrEmpty(urlBuilder.SelectNameColumn))
                return GetSelect(urlBuilder.SelectNameColumn).Cast<IDataRow>().Select(r => r);
            return GetSelect().Cast<IDataRow>().Select(r => r);
        }

        IQueryable<IDataRow> IDataSourceViewExtNet.GetFullModelData(string queryParameters)
        {
            DB.ObjectTrackingEnabled = false;
            DB.DeferredLoadingEnabled = false;
            _filterSelect = new MyProductActionsFilter();
            var url = "/MainPage.aspx/data/MyProductActionsJournal/Select"
                      + (!string.IsNullOrEmpty(queryParameters) && queryParameters[0] == '/'
                          ? queryParameters
                          : "?" + queryParameters);
            var urlBuilder = new MainPageUrlBuilder(url);
            _filterSelect.SetUrl(urlBuilder);
            _filterSelect.SetDB(DB);
            _filterSelect.ShowHistory = urlBuilder.ShowHistory;
            _url = urlBuilder;
            AddSearchInFilter(urlBuilder, _filterSelect);
            SelectForAddType = urlBuilder.SelectForAddType;
            SelectParameters = urlBuilder.SelectParameters;
            IQueryable<Row> data;
            if (!string.IsNullOrEmpty(urlBuilder.SelectNameColumn))
                data = GetSelect(urlBuilder.SelectNameColumn);
            else
                data = GetSelect();

            return data.Select(GetFullModelDataExpression).Cast<IDataRow>();
        }

        IQueryable<IDataRow> IDataSourceViewExtNet.GetFullModelData(string queryParameters, string refParent)
        {
            throw new NotSupportedException();
        }

        public Expression<Func<Row, IDataRow>> GetFullModelDataExpression
        {
            get
            {
                return row => new ModelData
                    {
                        CanEdit = row.CanEdit,
                        CanDelete = row.CanDelete,
                        id = row.Item.id,
                        refProduct = row.Item.refProduct,
                        refProduct_Name = row.Lookup.refProduct_Name,
                        DateTimeAction = row.Item.DateTimeAction,
                        AmountChange = row.Item.AmountChange,
                        Note = row.Item.Note,
                        RowVersion = row.Item.RowVersion,
                        nameRu = row.nameRu,
                        nameKz = row.nameKz,
                    };
            }
        }

        public override IQueryable<ICodeRow> GetSelectICodeRow(string queryParameters)
        {
            throw new NotImplementedException();
        }

        IQueryable<IDataCodeRow> IDataSourceView2.GetSelectICodeRow(string queryParameters)
        {
            throw new NotImplementedException();
        }

        public override BaseInformationValues Validate(long value, CancelEventArgs args)
        {
            var row = GetCacheSelect(value);
            if (row == null)
            {
                args.Cancel = true;
                return null;
            }
            if (row.Information != null)
                row.Information.Validate();
            return row.Information;
        }

        public override Row[] ValidateAll(long[] values, CancelEventArgs args)
        {
            var rememberShowHistory = _showHistory;
            var recArgs = args as RecordValidateArgs;
            if (recArgs != null && recArgs.IgnoreHistoryFilter)
                _showHistory = true;
            var rows = GetSelect().Where(r => values.Contains(r.id)).ToArray();
            _showHistory = rememberShowHistory;

            if (rows.Length == 0)
            {
                args.Cancel = true;
                return new Row[0];
            }
            foreach (var row in rows.Where(row => row.Information != null))
                row.Information.Validate();
            return rows;
        }

        public override BaseInformationValues Validate(long value, RecordValidateArgs args)
        {
            var rememberShowHistory = _showHistory;
            if (args.IgnoreHistoryFilter)
                _showHistory = true;
            var row = GetCacheSelect(value);
            _showHistory = rememberShowHistory;
            if (row == null || (!row.CanAddChild && args.SelectForAddChild))
            {
                args.Cancel = true;
                return null;
            }
            if (row.Information != null)
                row.Information.Validate();
            return row.Information;
        }

        public override bool CheckPermit()
        {
            return AccessOptions.CheckPermit();
        }

        public override BaseFilterControl<long> CreateDefaultFilter(MainPageUrlBuilder urlBuilder)
        {
            var control = new MyProductActionsFilter();
            urlBuilder.UserControl = MyProductActionsFilter.ConstOfColumnNames.JournalName;
            return control;
        }

        protected override Expression GetFilteredExpression(Expression query, QueryParameters qParams, out BaseFilterControl<long, MyProductAction, DBDataContext> outFilterControl)
        {
            MyProductActionsFilter filterControl = _filterSelect;
            if (_filterSelect == null)
            {
                var args = new DataSourceSelectingEventArgs { DB = DB };
                if (owner != null) owner.OnSelecting(args);
                filterControl = (MyProductActionsFilter)args.FilterControl;
            }
            if(filterControl == null)
            {
                var fc = new MyProductActionsFilter();
                filterControl = fc;
                fc.SetUrl(new MainPageUrlBuilder { SelectMode = "none", UserControl = MyProductActionsFilter.ConstOfColumnNames.JournalName, });
                fc.SetDB(DB);
            }
            if (_showHistory == null)
                _showHistory = filterControl.ShowHistory;
            else
                filterControl.ShowHistory = _showHistory.Value;
            _selectedID = filterControl.SelectedID;
            _url = filterControl.Url;
            outFilterControl = filterControl;
            return filterControl.GetFilteredExpression(query, qParams);
        }

        protected IQueryable<MyProductAction> SetFilter(IQueryable<MyProductAction> queryable)
        {
            MyProductActionsFilter filterControl = _filterSelect;
            if (_filterSelect == null)
            {
                var args = new DataSourceSelectingEventArgs { DB = DB };
                owner.OnSelecting(args);
                filterControl = (MyProductActionsFilter)args.FilterControl;
            }
            if (filterControl == null)
            {
                var fc = new MyProductActionsFilter();
                filterControl = fc;
                fc.SetUrl(new MainPageUrlBuilder { SelectMode = "none", UserControl = MyProductActionsFilter.ConstOfColumnNames.JournalName });
                fc.SetDB(DB);
                if (!string.IsNullOrEmpty(SelectedRowKey))
                    filterControl.SelectedID = Convert.ToInt64(SelectedRowKey);
            }
            if (_showHistory == null)
                _showHistory = filterControl.ShowHistory;
            else
                filterControl.ShowHistory = _showHistory.Value;
            _selectedID = filterControl.SelectedID;
            _url = filterControl.Url;
            return (IQueryable<MyProductAction>)filterControl.SetFilters(queryable);
        }

        public partial class TotalInfo
        {
        }

        partial void GetTotalInfo(DataSourceSelectArguments arguments, ref IEnumerable<TotalInfo> result);

        public IEnumerable<TotalInfo> GetTotalInfo(DataSourceSelectArguments arguments)
        {
            IEnumerable<TotalInfo> result = null;
            GetTotalInfo(arguments, ref result);
            return result;
        }

        partial void ChangeSelect(ref Expression<Func<MyProductAction, LookupValues, InformationValues>> informationExpression);
        partial void ChangeSelectDB(ref Expression<Func<DBDataContext, MyProductAction, LookupValues, InformationValues>> informationExpression);
        
        private static ConstructorInfo rowCtr = typeof(Row).GetConstructor(new [] { typeof(MyProductAction), typeof(LookupValues), typeof(InformationValues), typeof(string), typeof(string), typeof(bool), typeof(bool), typeof(bool), typeof(Int64) });
        private static ConstructorInfo lookupCtr = typeof(LookupValues).GetConstructor(new[] { typeof(string), typeof(object[]) });
        
        private IQueryable<Row> ChangeSelect(IQueryable<MyProductAction> query, string selectColumnName)
        {
            var isKz = System.Globalization.CultureInfo.CurrentUICulture.Name.Equals("kk-kz", StringComparison.OrdinalIgnoreCase);
            return ChangeSelect(query, selectColumnName, isKz);
        }
        
        private IQueryable<Row> ChangeSelect(IQueryable<MyProductAction> query, string selectColumnName, bool isKz)
        {
            Expression exp = GetSelectedRowExpression(query.Expression, selectColumnName, isKz, null);
            return query.Provider.CreateQuery<Row>(exp);
        }
        
        protected override Expression GetSelectedRowExpression(Expression query, string selectColumnName, bool isKz, QueryParameters qParams)
        {
            WriteTrace("MyProductActionsJournalDataSourceView.ChangeSelect.Begin");
            if (qParams != null)
                qParams.SelectColumnName = selectColumnName;
            var showHistory = _showHistory == null || _showHistory.Value;
            var time = DateTime.Now;
            IQueryable<Row> result;
        
            var param = Expression.Parameter(typeof(MyProductAction), "c");
            Lookup.IsKz = isKz;
            Lookup.DB = DB;
            Lookup.ShowHistory = showHistory;
            Lookup.QueryParameters = qParams;
            if (qParams != null)
            {
                qParams.AddUniqueParameter("IsKz=" + isKz);
                qParams.AddUniqueParameter("ShowHistory=" + showHistory);
            }
            var selectedAdditionalValuesExp = GetSelectedAdditionalValuesExpression(DB, param);
            Expression lookupExp = Expression.New(lookupCtr, 
                new Expression[] { Lookup.GetExpressionrefProduct(param),  selectedAdditionalValuesExp }, 
                new MemberInfo[] {typeof(LookupValues).GetMember("refProduct_Name")[0],  typeof(LookupValues).GetMember("SelectedAdditionalValues")[0]});
            Expression lookupPred = Expression.Lambda(lookupExp, param);
            Expression<Func<MyProductAction, LookupValues, InformationValues>> informationExpression = null;
            Expression<Func<DBDataContext, MyProductAction, LookupValues, InformationValues>> informationExpressionDB = null;
            ChangeSelect(ref informationExpression);
            ChangeSelectDB(ref informationExpressionDB);
            Expression informationExp;
            Type selectType = typeof(MyProductAction);
        
            if (informationExpressionDB != null)
                informationExp = Expression.Invoke(informationExpressionDB, qParams.GetDBExpression(DB), param, lookupExp);
            else if (informationExpression != null)
                informationExp = Expression.Invoke(informationExpression, param, lookupExp);
            else
                informationExp = Expression.Constant(null, typeof(InformationValues)); 
        
            Expression<Func<MyProductAction, string>> nameRuExp;
            Expression<Func<MyProductAction, string>> nameKzExp;
            GetNameExpressions(selectColumnName, out nameRuExp, out nameKzExp);
            Expression<Func<MyProductAction, Int64>> idKeyExp = p => p.id;
            Expression expItem = param;
        
            Expression canEditExp;
            Expression canDeleteExp;
            GetEditAndDeleteExpressions(expItem, informationExp, out canEditExp, out canDeleteExp);
            
            Expression canAddChildExp = null;
            Type selectForAddType = string.IsNullOrEmpty(SelectForAddType) ? null : BuildManager.GetType(SelectForAddType, true, true);
            if (selectForAddType != null)
                canAddChildExp = GetAddChildExpression(null, selectForAddType, expItem, param, new Expression[0]);
            if (canAddChildExp == null)
                canAddChildExp = Expression.Constant(true);
            
            var rowExp = Expression.New(rowCtr, 
                new Expression[] { expItem, lookupExp, informationExp, Expression.Invoke(nameRuExp, expItem), Expression.Invoke(nameKzExp, expItem), canEditExp, canDeleteExp, canAddChildExp, Expression.Invoke(idKeyExp, expItem) },
                new MemberInfo[] { typeof(Row).GetMember("Item")[0], typeof(Row).GetMember("Lookup")[0], typeof(Row).GetMember("Information")[0], typeof(Row).GetMember("nameRu")[0], typeof(Row).GetMember("nameKz")[0], typeof(Row).GetMember("CanEdit")[0], typeof(Row).GetMember("CanDelete")[0], typeof(Row).GetMember("CanAddChild")[0], typeof(Row).GetMember("id")[0] });
            Expression pred = Expression.Lambda(rowExp, param);
            Expression expr = Expression.Call(typeof(Queryable), "Select", new[] { selectType, typeof(Row) }, query, pred);
            WriteTrace("MyProductActionsJournalDataSourceView.ChangeSelect.End");
            return expr;
        }
        
        partial void GetNameExpressionPartial(string selectColumnName, ref Expression<Func<MyProductAction, string>> nameRuExp, ref Expression<Func<MyProductAction, string>> nameKzExp);
        
        private void GetNameExpressions(string selectColumnName, out Expression<Func<MyProductAction, string>> nameRuExp, out Expression<Func<MyProductAction, string>> nameKzExp)
        {
            nameRuExp = nameKzExp = null;
            GetNameExpressionPartial(selectColumnName, ref nameRuExp, ref nameKzExp);
            if (nameRuExp != null && nameKzExp != null)
                return;
        
            if (string.IsNullOrEmpty(selectColumnName))
            {
                nameKzExp = nameRuExp = p => p.MyProduct_refProduct.Name;
            }
            else
            {
                switch(selectColumnName)
                {
                    case "refProduct":
                        nameRuExp = r => r.MyProduct_refProduct.Name.ToString();
                        nameKzExp = r => r.MyProduct_refProduct.Name.ToString();
                        break;
                    case "DateTimeAction":
                        nameKzExp = nameRuExp = r => string.Format("{0:d}", r.DateTimeAction.ToString());
                        break;
                    case "AmountChange":
                        nameKzExp = nameRuExp = r => r.AmountChange.ToString();
                        break;
                    case "Note":
                        nameKzExp = nameRuExp = r => r.Note.ToString();
                        break;
                    default:
                        throw new ArgumentException("Не найдена соответствующая колонка", "selectColumnName");
                }
            }
        }
        
        private MyProductsJournalDataSource _cachedMyProductsDataSource;
        
        bool _canEditAndDeleteExpressionInitialized = false;
        Expression _canEditAndDeleteExpCache;
        Expression _canEditExpCache;
        Expression _canDeleteExpCache;
        partial void SetCanEditAndDeleteExpression(BaseFilterEventArgs<MyProductAction> filterArgs);
        partial void SetCanEditExpression(BaseFilterEventArgs<MyProductAction> filterArgs);
        partial void SetCanDeleteExpression(BaseFilterEventArgs<MyProductAction> filterArgs);
        partial void SetCanEditAndDeleteExpression(BaseFilterEventArgs<MyProductAction, DBDataContext> filterArgs);
        partial void SetCanEditExpression(BaseFilterEventArgs<MyProductAction, DBDataContext> filterArgs);
        partial void SetCanDeleteExpression(BaseFilterEventArgs<MyProductAction, DBDataContext> filterArgs);
        
        private void GetEditAndDeleteExpressions(Expression expItem, Expression informationExp, out Expression canEditExp, out Expression canDeleteExp)
        {
            if (AllowSelectOnlyNames)
            {
                canEditExp = Expression.Constant(false);
                canDeleteExp = Expression.Constant(false);
                return;
            }
            Expression canEditExpression = null;
            Expression canDeleteExpression = null;
            Expression canEditAndDeleteExpression = null;
        
            if (_canEditAndDeleteExpressionInitialized)
            {
                canEditAndDeleteExpression = _canEditAndDeleteExpCache;
                canEditExpression = _canEditExpCache;
                canDeleteExpression = _canDeleteExpCache;
            }
            else
            {
                _canEditAndDeleteExpCache = canEditAndDeleteExpression = GetEditAndDeleteExpression(canEditAndDeleteExpression);
                _canEditExpCache = canEditExpression = GetEditExpression(canEditExpression);
                _canDeleteExpCache = canDeleteExpression = GetDeleteExpression(canDeleteExpression);
            }
            canEditExp = canEditExpression == null ? (Expression)Expression.Constant(true) : Expression.Invoke(canEditExpression, expItem);
            canDeleteExp = canDeleteExpression == null ? (Expression)Expression.Constant(true) : Expression.Invoke(canDeleteExpression, expItem);
            if (canEditAndDeleteExpression != null)
            {
                Expression canEditAndDeleteExp = Expression.Invoke(canEditAndDeleteExpression, expItem);
                canEditExp = Expression.And(canEditAndDeleteExp, canEditExp);
                canDeleteExp = Expression.And(canEditAndDeleteExp, canDeleteExp);
            }
        }
        
        public override BaseFilterEventArgs<MyProductAction> GetEditAndDeleteFilter(Type typeOfData)
        {
            var filterArgs = base.GetEditAndDeleteFilter(typeOfData);
        
            SetCanEditAndDeleteExpression(filterArgs);
            SetCanEditAndDeleteExpression((BaseFilterEventArgs<MyProductAction, DBDataContext>)filterArgs);
            return filterArgs;
        }
        /*
        public override Expression GetEditAndDeleteByParents<T>(Expression source, ParameterExpression param, Expression upToTable, IEnumerable<Expression> fieldsToCheckReference)
        {
            var refProductControl = _cachedMyProductsDataSource;
            if (refProductControl == null)
            {
                refProductControl = _cachedMyProductsDataSource = new MyProductsJournalDataSource();
                refProductControl.View.DB = DB;
            }
            var refProductToTable = Expression.Property(upToTable, "MyProduct_refProduct");
            var refProductToCheckReference = new List<Expression>(fieldsToCheckReference);
            source = refProductControl.View.GetEditAndDeleteExpression<T>(source, refProductToTable, param, refProductToCheckReference);
            return source;
        }*/
        
        public override BaseFilterEventArgs<MyProductAction> GetEditFilter(Type typeOfData)
        {
            var filterArgs = base.GetEditFilter(typeOfData);
        
            SetCanEditExpression(filterArgs);
            SetCanEditExpression((BaseFilterEventArgs<MyProductAction, DBDataContext>)filterArgs);
            return filterArgs;
        }
        /*
        public override Expression GetEditByParents<T>(Expression source, ParameterExpression param, Expression upToTable, IEnumerable<Expression> fieldsToCheckReference)
        {
            var refProductControl = _cachedMyProductsDataSource;
            if (refProductControl == null)
            {
                refProductControl = _cachedMyProductsDataSource = new MyProductsJournalDataSource();
                refProductControl.View.DB = DB;
            }
            var refProductToTable = Expression.Property(upToTable, "MyProduct_refProduct");
            var refProductToCheckReference = new List<Expression>(fieldsToCheckReference);
            source = refProductControl.View.GetEditExpression<T>(source, refProductToTable, param, refProductToCheckReference);
            return source;
        }*/
        
        public override BaseFilterEventArgs<MyProductAction> GetDeleteFilter(Type typeOfData)
        {
            var filterArgs = base.GetDeleteFilter(typeOfData);
        
            SetCanDeleteExpression(filterArgs);
            SetCanDeleteExpression((BaseFilterEventArgs<MyProductAction, DBDataContext>)filterArgs);
            return filterArgs;
        }
        /*
        public override Expression GetDeleteByParents<T>(Expression source, ParameterExpression param, Expression upToTable, IEnumerable<Expression> fieldsToCheckReference)
        {
            var refProductControl = _cachedMyProductsDataSource;
            if (refProductControl == null)
            {
                refProductControl = _cachedMyProductsDataSource = new MyProductsJournalDataSource();
                refProductControl.View.DB = DB;
            }
            var refProductToTable = Expression.Property(upToTable, "MyProduct_refProduct");
            var refProductToCheckReference = new List<Expression>(fieldsToCheckReference);
            source = refProductControl.View.GetDeleteExpression<T>(source, refProductToTable, param, refProductToCheckReference);
            return source;
        }*/
        
        private List<ParentDataSourceViewInfo> _parentDataSources = null;
        partial void InitializeParentCollection(ICollection<ParentDataSourceViewInfo> parentDataSources);
        
        public override IEnumerable<ParentDataSourceViewInfo> GetParentCollection()
        {
            if (_parentDataSources != null) return _parentDataSources;
             _parentDataSources = new List<ParentDataSourceViewInfo>();
            var refProductControl = new MyProductsJournalDataSource();
            refProductControl.View.DB = DB;
            _parentDataSources.Add(new ParentDataSourceViewInfo
                {
                    DataSource = refProductControl.View,
                    ReferenceName = "MyProduct_refProduct",
                    Mandatory = true,
                    FieldName = "refProduct",
                    TableType = typeof(MyProduct),
                });
            InitializeParentCollection(_parentDataSources);
            return _parentDataSources;
        }
        
        Expression _canAddExpCache;
        
        partial void SetCanAddChildsExpression(BaseFilterEventArgs<MyProductAction> filterArgs);
        
        protected override BaseFilterEventArgs<MyProductAction> GetAddRule(Type typeOfData)
        {
            var filterArgs = base.GetAddRule(typeOfData);
        
            SetCanAddChildsExpression(filterArgs);
            return filterArgs;
        }
        
        public override IEnumerable<IQueryable> AllowAddRowGetSources(BaseNavigatorValues valuesT)
        {
            if (InitConnection != null) DB.Transaction = InitTransaction;
            var values = (MyProductActionsNavigatorValues)valuesT;
            var sources = new List<IQueryable>();
            if (values.MyProducts.HasValue)
            {
                var id = values.MyProducts.Value;
                sources.Add(DB.MyProducts.Where(r => r.id == id));
            }
            return sources;
        }
        
        public override IQueryable<MyProductAction> GetSelectItems(long id)
        {
            if (InitConnection != null) DB.Transaction = InitTransaction;
            return DB.MyProductActions.Where(row => row.id == id);
        }
        
        public override IQueryable<MyProductAction> GetSelectItems()
        {
            if (InitConnection != null) DB.Transaction = InitTransaction;
            return DB.MyProductActions;
        }
        
        /*
        private IQueryable<Row> ChangeSelect(IQueryable<MyProductAction> query, string selectColumnName)
        {
            WriteTrace("MyProductActionsJournalDataSourceView.ChangeSelect.Begin");
            var isKz = System.Globalization.CultureInfo.CurrentUICulture.Name.Equals("kk-kz", StringComparison.OrdinalIgnoreCase);
            var time = DateTime.Now;
            IQueryable<Row> result;
            if (_showHistory == null || _showHistory.Value)
                result = from p in query
                    select new Row
                               {
                                   id = p.id,
                                   Value = p.id.ToString(),
                                   Item = p,
                                   Lookup = new LookupValues
                                                {
                                                    refProduct_Name = (isKz ? p.MyProduct_refProduct.Name : p.MyProduct_refProduct.Name).ToString(),
                                                 },
                                   nameRu = p.MyProduct_refProduct.Name.ToString(),
                                   nameKz = p.MyProduct_refProduct.Name.ToString(),
                               };
            else
                result = from p in query
                    select new Row
                               {
                                   id = p.id,
                                   Value = p.id.ToString(),
                                   Item = p,
                                   Lookup = new LookupValues
                                                {
                                                    refProduct_Name = (isKz ? p.MyProduct_refProduct.Name : p.MyProduct_refProduct.Name).ToString(),
                                                 },
                                   nameRu = p.MyProduct_refProduct.Name.ToString(),
                                   nameKz = p.MyProduct_refProduct.Name.ToString(),
                               };
            if (!string.IsNullOrEmpty(selectColumnName))
            {
                switch(selectColumnName)
                {
                    case "id":
                        result = result.Select(r => 
                           new Row 
                           {
                               id = r.id,
                               Value = r.Value,
                               Item = r.Item,
                               Lookup = r.Lookup,
                               Information = r.Information,
                               nameRu = r.Item.id.ToString(),
                               nameKz = r.Item.id.ToString(),
                           });
                        break;
                    case "refProduct":
                        result = result.Select(r => 
                           new Row 
                           {
                               id = r.id,
                               Value = r.Value,
                               Item = r.Item,
                               Lookup = r.Lookup,
                               Information = r.Information,
                               nameRu = r.Item.MyProduct_refProduct.Name.ToString(),
                               nameKz = r.Item.MyProduct_refProduct.Name.ToString(),
                           });
                        break;
                    case "DateTimeAction":
                        result = result.Select(r => 
                           new Row 
                           {
                               id = r.id,
                               Value = r.Value,
                               Item = r.Item,
                               Lookup = r.Lookup,
                               Information = r.Information,
                               nameRu = string.Format("{0:d}", r.Item.DateTimeAction.ToString()),
                               nameKz = string.Format("{0:d}", r.Item.DateTimeAction.ToString()),
                           });
                        break;
                    case "AmountChange":
                        result = result.Select(r => 
                           new Row 
                           {
                               id = r.id,
                               Value = r.Value,
                               Item = r.Item,
                               Lookup = r.Lookup,
                               Information = r.Information,
                               nameRu = r.Item.AmountChange.ToString(),
                               nameKz = r.Item.AmountChange.ToString(),
                           });
                        break;
                    case "Note":
                        result = result.Select(r => 
                           new Row 
                           {
                               id = r.id,
                               Value = r.Value,
                               Item = r.Item,
                               Lookup = r.Lookup,
                               Information = r.Information,
                               nameRu = r.Item.Note.ToString(),
                               nameKz = r.Item.Note.ToString(),
                           });
                        break;
                    case "RowVersion":
                        result = result.Select(r => 
                           new Row 
                           {
                               id = r.id,
                               Value = r.Value,
                               Item = r.Item,
                               Lookup = r.Lookup,
                               Information = r.Information,
                               nameRu = r.Item.RowVersion.ToString(),
                               nameKz = r.Item.RowVersion.ToString(),
                           });
                        break;
                    default:
                        throw new ArgumentException("Не найдена соответствующая колонка", "selectColumnName");
                }
            }
            WriteTrace("MyProductActionsJournalDataSourceView.ChangeSelect.End");
            return result;
        }*/

        public Row GetRecord(long id)
        {
            WriteTrace("MyProductActionsJournalDataSourceView.ChangeSelect.Begin");
            var query = DB.MyProductActions.AsQueryable();
            var resQuery = ChangeSelect(query, string.Empty);
            IQueryable<Row> result = null;
            //ChangeSelect(resQuery, ref result, DB);
            Row returnValue;
            if (result != null)
                returnValue = result.FirstOrDefault(p => p.Item.id == id);
            else
                returnValue = resQuery.FirstOrDefault(p => p.Item.id == id);
            WriteTrace("MyProductActionsJournalDataSourceView.ChangeSelect.End");
            return returnValue;
        }

        partial void InitializeStoreModelPartial(Ext.Net.Model model);

        public virtual void InitializeStoreModel(Ext.Net.Model model)
        {
            // todo: Add full store model scheme
            InitializeStoreModelPartial(model);
        }

        public virtual void InitializeStoreModelAdditional(Ext.Net.Model model)
        {
            InitializeStoreModelPartial(model);
        }



        public class Row : BaseRow
        {
            public Row()
            {
            }
        
            public Row(MyProductAction item, LookupValues lookup, InformationValues information, string nameRu, string nameKz, bool canEdit, bool canDelete, bool canAddChild, Int64 id)
            {
                Item = item;
                Lookup = lookup;
                Information = information;
                this.id = id;
                Value = id.ToString();
                this.nameRu = nameRu;
                this.nameKz = nameKz;
                CanEdit = canEdit;
                CanDelete = canDelete;
                CanAddChild = canAddChild;
            }
        
            public override string nameRu 
            { 
                get { return base.nameRu; }
                set { base.nameRu = value; } 
            }
        
            public override string nameKz
            {
                get { return base.nameKz; }
                set { base.nameKz = value; }
            }
        
            public override bool CanEdit
            {
                get { return base.CanEdit; }
                set { base.CanEdit = value; }
            }
        
            public override bool CanDelete
            {
                get { return base.CanDelete; }
                set { base.CanDelete = value; }
            }
        
            public override bool CanAddChild
            {
                get { return base.CanAddChild; }
                set { base.CanAddChild = value; }
            }
        
            public override long id
            {
                get { return base.id; }
                set { base.id = value; }
            }
        
            private LookupValues _lookup;
            public LookupValues Lookup
            {
                get { return _lookup; }
                set 
                { 
                    _lookup = value;
                    if (Item != null)
                    {
                        // Если нет полей с заполнением из БД, то избавляемся от дублирования объекта у строк
                        // Т.е. LinqToSql передает один объект всем строкам, а тут мы меняем поведение.
                        if (_lookup.Item != null)
                            _lookup = new LookupValues { SelectedAdditionalValues = new object[0] };
                        _lookup.Item = Item;
                    }
                    if (Information != null)
                        Information.Lookup = _lookup;
                    _lookup.Row = this;
                }
            }
        
            private InformationValues _information;
            public InformationValues Information
            {
                get { return _information; }
                set 
                { 
                    _information = value;
                    if (Item != null && _information != null)
                        _information.Item = Item;
                    if (Lookup != null && _information != null)
                        _information.Lookup = Lookup;
                }
            }
        
            [NonSerialized]
            MyProductAction _item;
            public MyProductAction Item 
            {
                get { return _item; }
                set 
                { 
                    _item = value;
                    if (Lookup != null)
                        Lookup.Item = value;
                    if (Information != null)
                        Information.Item = value;
                }
            }
        
            public string AdditionalValues
            {
                get { return Lookup == null ? null : Ext.Net.JSON.Serialize(Lookup.SelectedAdditionalValues); }
            }
        
            public override string[] GetAdditionalValues(SelectParameters selectParameters)
            {
                return Lookup == null ? null : Lookup.SelectedAdditionalValues.Select((r, i) => string.Format(selectParameters.SelectValues[i].Format, r)).ToArray();
            }
        
            public override object[] GetAdditionalValues()
            {
                return Lookup == null ? null : Lookup.SelectedAdditionalValues;
            }
        
            public virtual void SetValue(string strValue)
            {
                Value = strValue;
        
            }
        }

        [Serializable]
        public partial class LookupValues
        {
            public LookupValues()
            {
            }
        
            public LookupValues(string refProduct_Name, 
        object[] selectedAdditionalValues)
            {
                this.refProduct_Name = refProduct_Name;
                
                this.SelectedAdditionalValues = selectedAdditionalValues;
            }
        
            public string refProduct_Name { get; set; }
            
        
            [NonSerialized]
            MyProductAction _item;
        
            [ScriptIgnore]
            public MyProductAction Item 
            {
                get { return _item; }
                set { _item = value; }
            }
        
            [NonSerialized]
            Row _row;
        
            [ScriptIgnore]
            public Row Row
            {
                get { return _row; }
                set { _row = value; }
            }
        
            public object [] SelectedAdditionalValues { get; set; }
        }
        
        public partial class InformationValues : BaseInformationValues
        {
            public InformationValues()
            {
            }
        
            [NonSerialized]
            private LookupValues _lookup;
        
            [ScriptIgnore]
            public LookupValues Lookup
            {
                get { return _lookup; }
                set 
                { 
                    _lookup = value;
                    if (Item != null)
                        _lookup.Item = Item;
                }
            }
        
            [NonSerialized]
            private MyProductAction _item;
        
            [ScriptIgnore]
            public MyProductAction Item
            {
                get { return _item; }
                set 
                { 
                    _item = value;
                    if (Lookup != null)
                        Lookup.Item = value;
                }
            }
        }
        
        public partial class ModelData : BaseRow
        {
            public ModelData()
            {
            }
        
            public System.Int64 id { get; set; }
        
            public System.Int64 refProduct { get; set; }
        
            public string refProduct_Name { get; set; }
        
            public System.DateTime DateTimeAction { get; set; }
        
            public System.Decimal AmountChange { get; set; }
        
            public System.String Note { get; set; }
        
            public System.Data.Linq.Binary RowVersion { get; set; }
        }
        
        
        
        public class LookupExpressions
        {
            private static readonly Expression NullExpression = Expression.Constant(null, typeof(string));
            private static readonly Expression NullIntExpression = Expression.Constant(0, typeof(int));
        
            private bool isKz { get; set; }
        
            public bool IsKz
            {
                get { return isKz; } 
                set { isKz = value; }
            }
        
            private bool showHistory { get; set; }
        
            public bool ShowHistory
            {
                get { return showHistory; } 
                set { showHistory = value; }
            }
        
            private QueryParameters qParams { get; set; }
        
            public QueryParameters QueryParameters
            {
                get { return qParams; } 
                set { qParams = value; }
            }
            
            public Func<MainPageUrlBuilder> GetUrl { get; set; }
        
            public DBDataContext DB { get; set; }
            public bool DefaultHidden { get; set; }
            private bool? _refProductHidden;
        
            public bool refProductHidden
            {
                get { return _refProductHidden ?? DefaultHidden; }
                set { _refProductHidden = value; }
            }
        
            private static readonly Expression<Func<MyProductAction, string>> ruExpressionrefProduct = r =>r.MyProduct_refProduct.Name;
            private static Expression<Func<MyProductAction, string>> kzExpressionrefProduct = r =>r.MyProduct_refProduct.Name;
        
            public Expression GetExpressionrefProduct(ParameterExpression param)
            {
                if (refProductHidden)
                    return NullExpression;
                return Expression.Invoke(isKz ? kzExpressionrefProduct : ruExpressionrefProduct, param);
            }  
        }

        protected static IQueryable<MyProductAction> SetSortExpression(string sortExpression, IQueryable source)
        {
            Expression expression = source.Expression;
            string str = "OrderBy";
            string str2 = "OrderByDescending";
            foreach (string orderBy in sortExpression.Split(new[] { ',' }, StringSplitOptions.RemoveEmptyEntries))
            {
                var split = orderBy.Split(new[] { ' ' }, StringSplitOptions.RemoveEmptyEntries);
                bool ascending = true;
                if (split.Length == 2)
                    ascending = split[1].Equals("Asc", StringComparison.OrdinalIgnoreCase);

                string orderByColumn = split[0];
                ParameterExpression param = Expression.Parameter(typeof(MyProductAction), "c");
                Type fieldType;
                var property = LinqFilterGenerator.GetProperty(typeof(MyProductAction), orderByColumn, param, out fieldType);
                expression = Expression.Call(typeof(Queryable), ascending ? str : str2,
                                             new[] { typeof(MyProductAction), fieldType },
                                             expression,
                                             Expression.Lambda(property, param));
                str = "ThenBy";
                str2 = "ThenByDescending";
            }
            return (IQueryable<MyProductAction>)source.Provider.CreateQuery(expression);
        }
    }

    #endregion

    #region MyProductActionsJournalDataSource

    public class MyProductActionsJournalDataSource : BaseDataSource<long, MyProductAction, DBDataContext, MyProductActionsJournalDataSourceView.Row>, IDataSource
    {
        private MyProductActionsJournalDataSourceView view;

        public MyProductActionsJournalDataSourceView View
        {
            get
            {
                if(view == null)
                    view = new MyProductActionsJournalDataSourceView(this, "default");
                return view;
            }
        }

        public override BaseDataSourceView<long, MyProductAction, DBDataContext, MyProductActionsJournalDataSourceView.Row> BaseView2
        {
            get { return View; }
        }

        public MyProductActionsJournalDataSourceView.Row GetRecord(long id)
        {
            return View.GetRecord(id);
        }
    }

    #endregion

    #region FileManager

    

    #endregion

    #region AccessOptions

    public static partial class MyProductActionsAccessOptions
    {
        /// <summary>
        /// Изменение проверки прав, 
        /// если replace = true, то праверка прав возвращает isPermit, 
        /// иначе стандартная проверка прав и isPermit
        /// </summary>
        static partial void ChangeCheckPermit(ref bool replace, ref bool isPermit);
        
        public static bool CheckPermit()
        {
            bool replace = false;
            bool isPermit = true;
            ChangeCheckPermit(ref replace, ref isPermit);
            return isPermit;
        }
    
        /// <summary>
        /// Изменение проверки прав, 
        /// если replace = true, то праверка прав возвращает isPermit, 
        /// иначе стандартная проверка прав и isPermit
        /// </summary>
        static partial void ChangeCheckPermitAdd(ref bool replace, ref bool isPermit);
        
        public static bool CheckPermitAdd()
        {
            bool replace = false;
            bool isPermit = true;
            ChangeCheckPermitAdd(ref replace, ref isPermit);
            return isPermit;
        }
    
        /// <summary>
        /// Изменение проверки прав, 
        /// если replace = true, то праверка прав возвращает isPermit, 
        /// иначе стандартная проверка прав и isPermit
        /// </summary>
        static partial void ChangeCheckPermitEdit(ref bool replace, ref bool isPermit);
        
        public static bool CheckPermitEdit()
        {
            bool replace = false;
            bool isPermit = true;
            ChangeCheckPermitEdit(ref replace, ref isPermit);
            return isPermit;
        }
    
        /// <summary>
        /// Изменение проверки прав, 
        /// если replace = true, то праверка прав возвращает isPermit, 
        /// иначе стандартная проверка прав и isPermit
        /// </summary>
        static partial void ChangeCheckPermitDelete(ref bool replace, ref bool isPermit);
        
        public static bool CheckPermitDelete()
        {
            bool replace = false;
            bool isPermit = true;
            ChangeCheckPermitDelete(ref replace, ref isPermit);
            return isPermit;
        }
    }

    #endregion

    #region MyProductActionsItemNavigatorsInitializer

    public partial class MyProductActionsItemNavigatorsInitializer
    {
        protected MainPageUrlBuilder Url { get; set; }

        private DBDataContext _db;
        public DBDataContext DB
        {
            get
            {
                if (_db == null)
                {
                    _db = new DBDataContext(SpecificInstances.DbFactory.CreateConnection()) {ObjectTrackingEnabled = false};
                }

                return _db;
            }
            set { _db = value; }
        }

        partial void Initialize(IDictionary<Type, SelectedParameterNavigator.ItemNavigator> itemNavigators);

        public static void InitializeDic(IDictionary<Type, SelectedParameterNavigator.ItemNavigator> itemNavigators, MainPageUrlBuilder url)
        {
            var item = new MyProductActionsItemNavigatorsInitializer();
            item.Url = url;
            item.Initialize(itemNavigators);
            var i = item as IItemNavigatorsInitializer;
            if (i != null) i.Initialize(itemNavigators);
        }
    }

    #endregion
   
    #region MultipleKeyClass
    
    

    #endregion

    #region ActivityController

    namespace UserControls
    {
        using JS.LinqToJavaScript.Attributes;
    
        [SuppressMessage("StyleCop.CSharp.ReadabilityRules", "SA1121:UseBuiltInTypeAlias", Justification = "Reviewed. Suppression is OK here.")]
        [JavaScriptClass(ClassName = "MyProductActionsActivityController", Namespace = "SampleDictionaries", BaseClassName = "JS.Web.ActivityController")]
        internal partial class MyProductActionsActivityController : ActivityController
        {
            List<string> _activityControls;
            
            MyProductActionsEdit.ControlInfo Info { get; set; }
            
            /// <summary>
            /// Мой товар.
            /// </summary>
            [JavaScriptProperty]
            public ActivityControlrefProduct refProductControl { get; set; }
            
            /// <summary>
            /// Дата/время действия.
            /// </summary>
            [JavaScriptProperty]
            public ActivityControlDateTimeAction DateTimeActionControl { get; set; }
            
            /// <summary>
            /// Изменение кол-ва.
            /// </summary>
            [JavaScriptProperty]
            public ActivityControlAmountChange AmountChangeControl { get; set; }
            
            /// <summary>
            /// Примечание.
            /// </summary>
            [JavaScriptProperty]
            public ActivityControlNote NoteControl { get; set; }
            
            
            
            public override IEnumerable<string> ActivityControls
            {
                get 
                {
                    InitializeActivityControls();
                    return _activityControls;
                }
            }
    
            partial void InitializeActivity();
            partial void InitializeActivityControls(List<string> activityControls);
    
            public void Initialize(Control form, Dictionary<string, object> values, MyProductActionsEdit.ControlInfo info)
            {
                Info = info;
                ReadOnly = info.IsRead;
                IsNew = info.IsNew;
                Control control;
                string controlID;
                string clientID;
                control = info.refProductControl;
                controlID = control == null ? null : control.ID;
                clientID = control == null ? null : control.ClientID;
                refProductControl = new ActivityControlrefProduct(this, "refProduct", controlID);
                refProductControl.ClientID = clientID;
                refProductControl.Control = info.refProductControl;
                refProductControl.ReadOnlyChanged += (sender, args) =>
                    {
                        if (info.refProductControl != null)
                            info.refProductControl.ReadOnly = args.Value;
                    };
                refProductControl.DefaultAllowRequiredValidate = true;
                refProductControl.AllowRequiredValidateChanged += Nat.Web.Controls.ExtNet.Generation.ActivityControlExtensions.AllowRequiredValidateChanged(info.refProductControl);
                refProductControl.DefaultReadOnly = false;
                refProductControl.VisibleChanged += (sender, args) =>
                    {
                        if (info.refProductControl != null)
                        {
                            info.refProductControl.Hidden = !args.Value;
                            AbstractContainerExtender.SetHiddenControlContainer(info.refProductControl);
                        }
                    };
                refProductControl.EnabledChanged += (sender, args) =>
                    {
                        if (info.refProductControl != null)
                            info.refProductControl.Disabled = !args.Value;
                    };
                refProductControl.AllowValidateChanged += delegate(object sender, ActivityChangedEventArgs args)
                    {
                        if (info.refProductControl != null)
                            SetEnabledToValidators(form.Page, ValidationGroup, info.refProductControl.ID, args.Value);
                    };
                refProductControl.GetControlValueHandler = () => info.refProduct;
            
                control = info.DateTimeActionControl;
                controlID = control == null ? null : control.ID;
                clientID = control == null ? null : control.ClientID;
                DateTimeActionControl = new ActivityControlDateTimeAction(this, "DateTimeAction", controlID);
                DateTimeActionControl.ClientID = clientID;
                DateTimeActionControl.Control = info.DateTimeActionControl;
                DateTimeActionControl.ReadOnlyChanged += (sender, args) =>
                    {
                        if (info.DateTimeActionControl != null)
                            info.DateTimeActionControl.ReadOnly = args.Value;
                    };
                DateTimeActionControl.DefaultAllowRequiredValidate = true;
                DateTimeActionControl.AllowRequiredValidateChanged += Nat.Web.Controls.ExtNet.Generation.ActivityControlExtensions.AllowRequiredValidateChanged(info.DateTimeActionControl);
                DateTimeActionControl.DefaultReadOnly = true;
                DateTimeActionControl.VisibleChanged += (sender, args) =>
                    {
                        if (info.DateTimeActionControl != null)
                        {
                            info.DateTimeActionControl.Hidden = !args.Value;
                            AbstractContainerExtender.SetHiddenControlContainer(info.DateTimeActionControl);
                        }
                    };
                DateTimeActionControl.EnabledChanged += (sender, args) =>
                    {
                        if (info.DateTimeActionControl != null)
                            info.DateTimeActionControl.Disabled = !args.Value;
                    };
                DateTimeActionControl.AllowValidateChanged += delegate(object sender, ActivityChangedEventArgs args)
                    {
                        if (info.DateTimeActionControl != null)
                            SetEnabledToValidators(form.Page, ValidationGroup, info.DateTimeActionControl.ID, args.Value);
                    };
                DateTimeActionControl.GetControlValueHandler = () => info.DateTimeAction;
            
                control = info.AmountChangeControl;
                controlID = control == null ? null : control.ID;
                clientID = control == null ? null : control.ClientID;
                AmountChangeControl = new ActivityControlAmountChange(this, "AmountChange", controlID);
                AmountChangeControl.ClientID = clientID;
                AmountChangeControl.Control = info.AmountChangeControl;
                AmountChangeControl.ReadOnlyChanged += (sender, args) =>
                    {
                        if (info.AmountChangeControl != null)
                            info.AmountChangeControl.ReadOnly = args.Value;
                    };
                AmountChangeControl.DefaultAllowRequiredValidate = true;
                AmountChangeControl.AllowRequiredValidateChanged += Nat.Web.Controls.ExtNet.Generation.ActivityControlExtensions.AllowRequiredValidateChanged(info.AmountChangeControl);
                AmountChangeControl.DefaultReadOnly = false;
                AmountChangeControl.VisibleChanged += (sender, args) =>
                    {
                        if (info.AmountChangeControl != null)
                        {
                            info.AmountChangeControl.Hidden = !args.Value;
                            AbstractContainerExtender.SetHiddenControlContainer(info.AmountChangeControl);
                        }
                    };
                AmountChangeControl.EnabledChanged += (sender, args) =>
                    {
                        if (info.AmountChangeControl != null)
                            info.AmountChangeControl.Disabled = !args.Value;
                    };
                AmountChangeControl.AllowValidateChanged += delegate(object sender, ActivityChangedEventArgs args)
                    {
                        if (info.AmountChangeControl != null)
                            SetEnabledToValidators(form.Page, ValidationGroup, info.AmountChangeControl.ID, args.Value);
                    };
                AmountChangeControl.GetControlValueHandler = () => info.AmountChange;
            
                control = info.NoteControl;
                controlID = control == null ? null : control.ID;
                clientID = control == null ? null : control.ClientID;
                NoteControl = new ActivityControlNote(this, "Note", controlID);
                NoteControl.ClientID = clientID;
                NoteControl.Control = info.NoteControl;
                NoteControl.ReadOnlyChanged += (sender, args) =>
                    {
                        if (info.NoteControl != null)
                            info.NoteControl.ReadOnly = args.Value;
                    };
                NoteControl.DefaultAllowRequiredValidate = false;
                NoteControl.AllowRequiredValidateChanged += Nat.Web.Controls.ExtNet.Generation.ActivityControlExtensions.AllowRequiredValidateChanged(info.NoteControl);
                NoteControl.DefaultReadOnly = false;
                NoteControl.VisibleChanged += (sender, args) =>
                    {
                        if (info.NoteControl != null)
                        {
                            info.NoteControl.Hidden = !args.Value;
                            AbstractContainerExtender.SetHiddenControlContainer(info.NoteControl);
                        }
                    };
                NoteControl.EnabledChanged += (sender, args) =>
                    {
                        if (info.NoteControl != null)
                            info.NoteControl.Disabled = !args.Value;
                    };
                NoteControl.AllowValidateChanged += delegate(object sender, ActivityChangedEventArgs args)
                    {
                        if (info.NoteControl != null)
                            SetEnabledToValidators(form.Page, ValidationGroup, info.NoteControl.ID, args.Value);
                    };
                NoteControl.GetControlValueHandler = () => info.Note;
            
                InitializeControls(
                    refProductControl,
                    DateTimeActionControl,
                    AmountChangeControl,
                    NoteControl);
            
                Initialize(form, values);
                FormID = Info.FormControl.ClientID;
            
                InitializeActivity();
            }
            
            public override void Initialize(Control form, Dictionary<string, object> values)
            {
                if (form == null)
                {
                    refProductControl = new ActivityControlrefProduct(this, "refProduct", null);
                    DateTimeActionControl = new ActivityControlDateTimeAction(this, "DateTimeAction", null);
                    AmountChangeControl = new ActivityControlAmountChange(this, "AmountChange", null);
                    NoteControl = new ActivityControlNote(this, "Note", null);
            
                    InitializeActivity();
                }
            
                base.Initialize(form, values);
            }
            
            protected void InitializeActivityControls()
            {
                if (_activityControls != null) return;
            
                _activityControls = new List<string>
                    {
                        "refProductControl",
                        "dateTimeActionControl",
                        "amountChangeControl",
                        "noteControl",
                    };
                InitializeActivityControls(_activityControls);
            }
            
            
            
            /// <summary>
            /// Мой товар.
            /// </summary>
            [JavaScriptClass(ClassName = "MyProductActionsActivityController_ActivityControlrefProduct", Namespace = "SampleDictionaries", BaseClassName = "JS.Web.ActivityController")]
            public class ActivityControlrefProduct : ActivityControl<MyProductActionsActivityController, Int64>
            {
                public ActivityControlrefProduct(MyProductActionsActivityController activityController, string controlID, string controlName)
                    : base(activityController, controlID, controlName)
                {
                }
            }
            
            /// <summary>
            /// Дата/время действия.
            /// </summary>
            [JavaScriptClass(ClassName = "MyProductActionsActivityController_ActivityControlDateTimeAction", Namespace = "SampleDictionaries", BaseClassName = "JS.Web.ActivityController")]
            public class ActivityControlDateTimeAction : ActivityControl<MyProductActionsActivityController, DateTime>
            {
                public ActivityControlDateTimeAction(MyProductActionsActivityController activityController, string controlID, string controlName)
                    : base(activityController, controlID, controlName)
                {
                }
            }
            
            /// <summary>
            /// Изменение кол-ва.
            /// </summary>
            [JavaScriptClass(ClassName = "MyProductActionsActivityController_ActivityControlAmountChange", Namespace = "SampleDictionaries", BaseClassName = "JS.Web.ActivityController")]
            public class ActivityControlAmountChange : ActivityControl<MyProductActionsActivityController, Decimal>
            {
                public ActivityControlAmountChange(MyProductActionsActivityController activityController, string controlID, string controlName)
                    : base(activityController, controlID, controlName)
                {
                }
            }
            
            /// <summary>
            /// Примечание.
            /// </summary>
            [JavaScriptClass(ClassName = "MyProductActionsActivityController_ActivityControlNote", Namespace = "SampleDictionaries", BaseClassName = "JS.Web.ActivityController")]
            public class ActivityControlNote : ActivityControlClassValue<MyProductActionsActivityController, String>
            {
                public ActivityControlNote(MyProductActionsActivityController activityController, string controlID, string controlName)
                    : base(activityController, controlID, controlName)
                {
                }
            }
        }
    }

    #endregion

    #region ValidateInformationForm

    namespace UserControls
    {
        [SuppressMessage("StyleCop.CSharp.NamingRules", "SA1306:FieldNamesMustBeginWithLowerCaseLetter", Justification = "Reviewed. Suppression is OK here.")]
        internal class MyProductActionsValidateInformationForm : Nat.Web.Controls.ExtNet.Validators.ValidateInformationForm
        {
            private ValidateInformation _refProduct;
            private ValidateInformation _DateTimeAction;
            private ValidateInformation _AmountChange;
            private ValidateInformation _Note;
    
            public MyProductActionsValidateInformationForm(Control form)
                : base(form)
            {
            }
    
            public ValidateInformation refProduct
            {
                get
                {
                    if (_refProduct == null)
                    {
                        _refProduct = new ValidateInformation();
                        Validators["refProduct"] = _refProduct;
                    }
            
                    return _refProduct;
                }
            }
            
            public ValidateInformation DateTimeAction
            {
                get
                {
                    if (_DateTimeAction == null)
                    {
                        _DateTimeAction = new ValidateInformation();
                        Validators["DateTimeAction"] = _DateTimeAction;
                    }
            
                    return _DateTimeAction;
                }
            }
            
            public ValidateInformation AmountChange
            {
                get
                {
                    if (_AmountChange == null)
                    {
                        _AmountChange = new ValidateInformation();
                        Validators["AmountChange"] = _AmountChange;
                    }
            
                    return _AmountChange;
                }
            }
            
            public ValidateInformation Note
            {
                get
                {
                    if (_Note == null)
                    {
                        _Note = new ValidateInformation();
                        Validators["Note"] = _Note;
                    }
            
                    return _Note;
                }
            }
    
            public void AddDefaultValidatorsForrefProduct(MyProductActionsEdit.ControlInfo info)
            {
                refProduct.RequiredValidatorPropertieses.Add(new RequiredValidatorProperties { InitialValue = "" });
                if (Validators.ContainsKey("refProduct"))
                {
                    var validator = refProduct.RequiredValidatorPropertieses.FirstOrDefault();
                    if (validator != null && string.IsNullOrEmpty(validator.ErrorMessageInSummary))
                        validator.ErrorMessageInSummary = MyProductActionsEdit.GetRequiredMessage_refProduct();
                    if (validator != null && validator.InitialValue == null)
                        validator.InitialValue = "";
                }
            }
            
            public void AddDefaultValidatorsForDateTimeAction(MyProductActionsEdit.ControlInfo info)
            {
                if (Validators.ContainsKey("DateTimeAction"))
                {
                    var validator = DateTimeAction.RequiredValidatorPropertieses.FirstOrDefault();
                    if (validator != null && string.IsNullOrEmpty(validator.ErrorMessageInSummary))
                        validator.ErrorMessageInSummary = MyProductActionsEdit.GetRequiredMessage_DateTimeAction();
                    if (validator != null && validator.InitialValue == null)
                        validator.InitialValue = "";
                }
            }
            
            public void AddDefaultValidatorsForAmountChange(MyProductActionsEdit.ControlInfo info)
            {
                AmountChange.RequiredValidatorPropertieses.Add(new RequiredValidatorProperties { InitialValue = "" });
                AmountChange.RegexValidatorPropertieses.Add(
                    new RegexValidatorProperties 
                        {
                            ErrorMessage = Nat.Web.Controls.Properties.Resources.SNotCorrectNumber,
                            ErrorMessageInSummary = MyProductActionsEdit.GetNotCorrectNumberMessage_AmountChange(),
                            RegularExpression = @"\-?\d{0,5}((\.|,)\d{0,2})?",
                        });
                if (Validators.ContainsKey("AmountChange"))
                {
                    var validator = AmountChange.RequiredValidatorPropertieses.FirstOrDefault();
                    if (validator != null && string.IsNullOrEmpty(validator.ErrorMessageInSummary))
                        validator.ErrorMessageInSummary = MyProductActionsEdit.GetRequiredMessage_AmountChange();
                    if (validator != null && validator.InitialValue == null)
                        validator.InitialValue = "";
                }
            }
            
            public void AddDefaultValidatorsForNote(MyProductActionsEdit.ControlInfo info)
            {
                Note.RegexValidatorPropertieses.Add(
                    new RegexValidatorProperties
                        {
                            ErrorMessage = MyProductActionsEdit.GetMaxLengthMessage(500),
                            ErrorMessageInSummary = MyProductActionsEdit.GetMaxLengthOfField_Note(),
                            RegularExpression = @"(.|\s){0,500}",
                        });
                if (Validators.ContainsKey("Note"))
                {
                    var validator = Note.RequiredValidatorPropertieses.FirstOrDefault();
                    if (validator != null && string.IsNullOrEmpty(validator.ErrorMessageInSummary))
                        validator.ErrorMessageInSummary = MyProductActionsEdit.GetRequiredMessage_Note();
                    if (validator != null && validator.InitialValue == null)
                        validator.InitialValue = "";
                }
            }
        }
    }

    #endregion

    #region TableRowsConsts

    public static class MyProductActionsRowsConsts
    {
    
    }

    #endregion

    #region NavigatorControl

    public partial class MyProductActionsNavigatorControl : BaseNavigatorControl<MyProductActionsNavigatorValues>
    {
        public override Type NavigatorType { get { return typeof(MyProductActionsNavigatorInfo); } }
    }

    #endregion

    #region NavigatorValues

    public partial class MyProductActionsNavigatorValues : BaseNavigatorValues
    {
        public long? MyProductActions
        {
            get
            {
                if (!Values.ContainsKey(typeof(MyProductAction))) return null;
                return (long?)Values[typeof(MyProductAction)];
            }
            set
            {
                Values[typeof(MyProductAction)] = value;
            }
        }
        
        public long? MyProducts
        {
            get
            {
                if (!Values.ContainsKey(typeof(MyProduct))) return null;
                return (long?)Values[typeof(MyProduct)];
            }
            set
            {
                Values[typeof(MyProduct)] = value;
            }
        }
    
        protected override string TableName { get { return "MyProductActions"; } }
    }

    #endregion

    #region NavigatorInfoAllClasses

    public partial class MyProductActionsNavigatorInfo : BaseNavigatorInfo
    {
        public override Type TableType { get { return typeof(MyProductAction); } }
        public override Type DataSourceViewType { get { return typeof(MyProductActionsJournalDataSourceView); } }
        public override string TableName { get { return "MyProductActions"; } }
        public override string Header { get { return MyProductActionsResources.Header; } }
        public override string HeaderToChilds { get { return ""; } }
        public override string HeaderToParent { get { return ""; } }
        public override string ReferenceName { get { return ""; } }
        
        public override void Initialize()
        {
            BaseInitialize();
            
            ParentNavigators.Add(GetNavigator(typeof(FK_MyProductActions_MyProducts_refProductNavigatorInfo)));
        }
        
        
    }
    
    public partial class FK_MyProductActions_MyProducts_refProductNavigatorInfo : MyProductsNavigatorInfo
    {
        public override string HeaderToChilds { get { return MyProductsResources.FK_MyProductActions_MyProducts_refProduct_ToChildsHeader; } }
        public override string HeaderToParent { get { return MyProductsResources.FK_MyProductActions_MyProducts_refProduct_ToParentHeader; } }
        public override string ReferenceName { get { return "MyProduct_refProduct"; } }
    }

    #endregion

    #region ViewModeClass

    public enum ViewModeMyProductActions
    {
        none,
    }

    #endregion

    #region AdditionalRowInfoClasses

    

    #endregion

    #region TableParametersClasses

    

    #endregion

    #region TableInterface

    

    #endregion

    #region GetCacheNamesClass

    public static class MyProductActionsCacheNames
    {
        public static string Get_refProduct(DataContext db, long? rowValue)
        {
            return CacheQueries.GetNameCached<MyProduct, long?, string>(
                       db, rowValue, (r, id) => r.id == id,
                       r => r.Name,
                       new ExpressionCulture<Func<MyProduct, string>>("kk-kz", r => r.Name));
        }
    
        public static string Get_refProduct(DataContext db, MyProductAction row)
        {
            long? rowValue;
            rowValue = row.refProduct;
    
            return Get_refProduct(db, rowValue);
        }
    
        public static string GetByTime_refProduct(DataContext db, long? rowValue)
        {
            return CacheQueries.GetNameCached<MyProduct, long?, string>(
                       DateTime.Now.AddSeconds(20), Cache.NoSlidingExpiration, CacheItemPriority.BelowNormal,
                       db, rowValue, (r, id) => r.id == id,
                       r => r.Name,
                       new ExpressionCulture<Func<MyProduct, string>>("kk-kz", r => r.Name));
        }
    
        public static string GetByTime_refProduct(DataContext db, MyProductAction row)
        {
            long? rowValue;
            rowValue = row.refProduct;
    
            return GetByTime_refProduct(db, rowValue);
        }
    
        public static string GetRu_refProduct(DataContext db, long? rowValue)
        {
            return CacheQueries.GetNameCached<MyProduct, long?, string>(db, rowValue, (r, id) => r.id == id, r => r.Name);
        }
    
        public static string GetNameRu(DataContext db, long? rowValue)
        {
            return CacheQueries.GetNameCached<MyProductAction, long?, string>(
                        db, rowValue, (r, id) => r.id == id, r => r.MyProduct_refProduct.Name);
        }
    
        public static string GetName(DataContext db, long? rowValue)
        {
            return CacheQueries.GetNameCached<MyProductAction, long?, string>(
                        db, 
                        rowValue, 
                        (r, id) => r.id == id, 
                        r => r.MyProduct_refProduct.Name, 
                        new ExpressionCulture<Func<MyProductAction, string>>("kk-kz", r => r.MyProduct_refProduct.Name));
        }
        
        public static void ClearCache(DataContext db, long? rowValue)
        {
            if (rowValue == null)
                return;
            CacheQueries.ClearCache<MyProductAction, long?, string>(
                db,
                rowValue.Value, 
                (r, id) => r.id == id, 
                r => r.MyProduct_refProduct.Name, 
                new ExpressionCulture<Func<MyProductAction, string>>("kk-kz", r => r.MyProduct_refProduct.Name));
        }
    }

    #endregion

    #region ComboBoxViews

    

    #endregion
}
#pragma warning restore